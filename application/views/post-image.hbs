<!--
❖ post-image.hbs – for registered users to post images 
    ▪ Must have document title
    ▪ Must have a section heading introducing the form 
    ▪ Input fields are REQUIRED to be in form tags.
    ▪ Must ask user to input a post Title
    ▪ Must ask user to input a post Description
    ▪ Must ask user to input an image (or images, this is your choice)
    ▪ Must ask user to accept Acceptable Use Policy for uploading images. 
    ▪ Must ask user to submit image post via a button.
-->

<div class="container">
  <h1 class="title">Post an Image</h1>
  <form
    id="post-image-form"
    class="form-container"
    method="POST"
    enctype="multipart/form-data"
    action="/posts/createPost"
  >

    <label for="post-title-input">Post Title:</label>
    <input
      type="text"
      id="post-title-input"
      placeholder="Title"
      name="title"
      required
    />

    <label for="post-description-input">Post Description:</label>
    <input
      type="text"
      id="post-description-input"
      placeholder="Description of your post."
      name="description"
      required
    />

    <label for="image-input">Upload an Image:</label>
    <input 
      type="file" 
      name="imageUpload" 
      id="image-input" 
      required 
    />

    <label for="use-policy-check">Do you agree to the
      <a href="fake-AUP.sfsu.edu">Acceptable Use Policy</a>?</label>
    <input
      type="checkbox"
      id="use-policy-check"
      name="use-policy-check"
      value="checked"
      required
    />

    <input type="submit" id="submit-image" value="Post Image" />
  </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  // const axios = require('axios');

  const _form = document.getElementById('post-image-form');
  _form.onsubmit = function(event) {
    event.preventDefault();
    let _body = new FormData(_form);

    /* TODO: choose between redirect, fetch, or axios
    {{!-- fetch("/posts/createPost", {
      method: "POST",
      body: _body
    })
    .then((data) => {
      console.log(data);
      return data.json();
    })
    .then((dataAsObject) => {
      console.log(dataAsObject);
      alert(dataAsObject.message);
      location.replace(dataAsObject.redirect);
    })
    .catch((err) => {
      console.log(err);
    }) --}}
    */

    axios.post("/posts/createPost", _body)
    .then((data) => {
      let dataAsObject = data.data;
      console.log(dataAsObject);
      alert(dataAsObject.message);
      location.replace(dataAsObject.redirect);
    })
    .catch((err) => {
      console.log(err);
    })
  }
</script>